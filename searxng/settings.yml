# SearXNG Configuration for Recovery Bot
# Documentation: https://docs.searxng.org/admin/settings/
# Updated: 2025-12-31 - Added Tor proxy, intelligent throttling, Mojeek engine
# Google disabled due to upstream bug #5286 - revisit Jan 2026

use_default_settings: true

general:
  debug: false
  instance_name: "Recovery Bot Search"
  privacypolicy_url: false
  donation_url: false
  contact_url: false
  enable_metrics: true

search:
  safe_search: 0
  autocomplete: "duckduckgo"
  default_lang: "en-US"
  # Adaptive rate limiting: exponential backoff on engine failures
  # Starts at 5s, doubles each failure up to 600s (10 min) max
  ban_time_on_fail: 5
  max_ban_time_on_fail: 600

  formats:
    - html
    - json
    - csv
    - rss

server:
  bind_address: "0.0.0.0"
  port: 8080
  secret_key: "${SEARXNG_SECRET}"
  limiter: false
  public_instance: false
  image_proxy: true
  http_protocol_version: "1.1"
  method: "GET"

redis:
  url: "redis://redis:6379/0"

ui:
  static_use_hash: true
  default_theme: simple
  center_alignment: true
  default_locale: "en"
  results_on_new_tab: false

outgoing:
  request_timeout: 20.0
  max_request_timeout: 45.0
  useragent_suffix: ""
  pool_connections: 50
  pool_maxsize: 10
  enable_http2: true
  # Tor SOCKS5 proxy for anonymous requests (reduces bot detection)
  # socks5h:// ensures DNS resolution through Tor (no DNS leaks)
  # DISABLED: Tor proxy timing out - 2026-01-02
  # proxies:
  #   all://:
  #     - socks5h://tor:9050
  # using_tor_proxy: true
  # extra_proxy_timeout: 30

engines:
  # =============================================================
  # PRIMARY SEARCH ENGINES (with weights)
  # =============================================================

  # DISABLED - Upstream bug #5286 (Oct 2025) - revisit Jan 2026
  - name: google
    engine: google
    shortcut: g
    disabled: true

  - name: brave
    engine: brave
    shortcut: br
    weight: 1.5
    disabled: false
    timeout: 6.0

  - name: bing
    engine: bing
    shortcut: b
    weight: 1.2
    disabled: false
    timeout: 6.0

  - name: startpage
    engine: startpage
    shortcut: sp
    weight: 0.8
    disabled: true  # CAPTCHA issues (2025-12-31)
    timeout: 6.0

  - name: duckduckgo
    engine: duckduckgo
    shortcut: ddg
    weight: 0.7
    disabled: true  # CAPTCHA issues (2025-12-31)
    timeout: 4.0

  # ALTERNATIVE ENGINES (Added 2025-12-31 per 4-agent research)
  - name: mojeek
    engine: mojeek
    shortcut: mj
    weight: 1.1
    disabled: false
    timeout: 8.0

  - name: yep
    engine: yep
    shortcut: yep
    weight: 1.0
    disabled: true  # HTTP 403 - bot protection (2025-12-31)
    timeout: 5.0
    search_type: web

  # =============================================================
  # REFERENCE
  # =============================================================
  - name: wikipedia
    engine: wikipedia
    shortcut: wp
    disabled: false
    timeout: 3.0

  # =============================================================
  # NEWS ENGINES
  # =============================================================
  - name: google news
    engine: google_news
    shortcut: gn
    categories: news
    disabled: true  # Depends on broken Google

  - name: bing news
    engine: bing_news
    shortcut: bn
    categories: news
    disabled: false

  # =============================================================
  # MAP ENGINES
  # =============================================================
  - name: openstreetmap
    engine: openstreetmap
    shortcut: osm
    categories: map
    disabled: false

  # =============================================================
  # ACADEMIC/RESEARCH ENGINES
  # =============================================================
  - name: google scholar
    engine: google_scholar
    shortcut: gs
    categories: science
    disabled: true  # Depends on broken Google
    timeout: 15.0

  - name: arxiv
    engine: arxiv
    shortcut: arx
    categories: science
    disabled: false
    timeout: 12.0

  - name: semantic scholar
    engine: semantic_scholar
    shortcut: ss
    categories: science
    disabled: false
    timeout: 12.0

  - name: pubmed
    engine: pubmed
    shortcut: pm
    categories: science
    disabled: false
    timeout: 15.0

  - name: crossref
    engine: crossref
    shortcut: cr
    categories: science
    disabled: false
    timeout: 30.0

  # OpenAlex - Free academic search (240M+ works, 100K requests/day)
  # Documentation: https://docs.openalex.org/api-entities/works/search-works
  - name: openalex
    engine: json_engine
    shortcut: oa
    categories: science
    disabled: false
    timeout: 15.0
    paging: true
    page_size: 25
    first_page_num: 1
    search_url: https://api.openalex.org/works?search={query}&per-page=25&page={pageno}&mailto=recoverybot@sparkonelabs.com
    results_query: results
    url_query: id
    title_query: display_name
    content_query: title
    # Note: OpenAlex returns work ID as URL, actual DOI in separate field

  # =============================================================
  # Q&A - STACK EXCHANGE NETWORK
  # =============================================================
  - name: stackoverflow
    engine: stackexchange
    shortcut: st
    api_site: 'stackoverflow'
    categories: [it, q&a]
    disabled: false
    timeout: 8.0

  - name: askubuntu
    engine: stackexchange
    shortcut: ubuntu
    api_site: 'askubuntu'
    categories: [it, q&a]
    disabled: false
    timeout: 8.0

  - name: superuser
    engine: stackexchange
    shortcut: su
    api_site: 'superuser'
    categories: [it, q&a]
    disabled: false
    timeout: 8.0

  - name: serverfault
    engine: stackexchange
    shortcut: sf
    api_site: 'serverfault'
    categories: [it, q&a]
    disabled: false
    timeout: 8.0

  - name: unix stackexchange
    engine: stackexchange
    shortcut: unix
    api_site: 'unix'
    categories: [it, q&a]
    disabled: false
    timeout: 8.0

  - name: electronics stackexchange
    engine: stackexchange
    shortcut: ee
    api_site: 'electronics'
    categories: [it, q&a, science]
    disabled: false
    timeout: 8.0

  - name: robotics stackexchange
    engine: stackexchange
    shortcut: rob
    api_site: 'robotics'
    categories: [it, q&a, science]
    disabled: false
    timeout: 8.0

  # =============================================================
  # CODE REPOSITORIES
  # =============================================================
  - name: github
    engine: github
    shortcut: gh
    categories: it
    disabled: false
    timeout: 10.0

  - name: gitlab
    engine: gitlab
    base_url: https://gitlab.com
    shortcut: gl
    categories: [it, repos]
    disabled: false
    timeout: 10.0

  - name: codeberg
    engine: gitea
    base_url: https://codeberg.org
    shortcut: cb
    categories: [it, repos]
    disabled: false
    timeout: 10.0

  # =============================================================
  # PACKAGE MANAGERS
  # =============================================================
  - name: dockerhub
    engine: docker_hub
    shortcut: dock
    categories: it
    disabled: false
    timeout: 10.0

  - name: npm
    engine: npm
    shortcut: npmpkg
    categories: it
    disabled: false
    timeout: 10.0

  - name: pypi
    engine: pypi
    shortcut: pip
    categories: it
    disabled: false
    timeout: 10.0

  - name: crates.io
    engine: crates
    shortcut: crates
    categories: [it, packages]
    disabled: false
    timeout: 6.0

  - name: pkg.go.dev
    engine: pkg_go_dev
    shortcut: pgo
    categories: [it, packages]
    disabled: false
    timeout: 6.0

  # =============================================================
  # COMMUNITY/FORUMS
  # =============================================================
  - name: reddit
    engine: reddit
    shortcut: re
    categories: general
    disabled: false
    timeout: 10.0

  - name: hackernews
    engine: hackernews
    shortcut: hn
    categories: it
    disabled: false
    timeout: 10.0

  # =============================================================
  # DOCUMENTATION WIKIS
  # =============================================================
  - name: arch linux wiki
    engine: archlinux
    shortcut: al
    categories: [it, software wikis]
    disabled: false

  - name: gentoo
    engine: mediawiki
    shortcut: ge
    categories: [it, software wikis]
    base_url: "https://wiki.gentoo.org/"
    api_path: "api.php"
    search_type: text
    timeout: 10.0
    disabled: false

  # =============================================================
  # INDUSTRIAL AUTOMATION / CNC FORUMS (Added 2025-12-31)
  # NOTE: These forums have bot protection - disabled
  # Use Reddit + Stack Exchange (robotics, electronics) for industrial topics
  # =============================================================
  - name: cnczone
    engine: xpath
    search_url: https://www.cnczone.com/forums/search.php?q={query}
    url_xpath: //a[contains(@class, "searchResult")]/@href
    title_xpath: //a[contains(@class, "searchResult")]
    content_xpath: //div[@class="searchResult"]/p
    categories: [it, science]
    shortcut: cnc
    timeout: 15.0
    disabled: true  # Bot protection - access denied

  - name: plctalk
    engine: xpath
    search_url: https://www.plctalk.net/threads/?q={query}
    url_xpath: //a[contains(@class, "preview")]/@href
    title_xpath: //a[contains(@class, "preview")]
    content_xpath: //div[@class="contentRow-snippet"]
    categories: [it, science]
    shortcut: plc
    timeout: 15.0
    disabled: true  # Bot protection - access denied

  - name: practical machinist
    engine: xpath
    search_url: https://www.practicalmachinist.com/forum/search/?q={query}
    url_xpath: //a[@class="contentRow-title"]/@href
    title_xpath: //a[@class="contentRow-title"]
    content_xpath: //div[@class="contentRow-snippet"]
    categories: [it, science]
    shortcut: pmach
    timeout: 15.0
    disabled: true  # Bot protection likely

  # =============================================================
  # DISABLED ENGINES
  # =============================================================
  - name: yahoo
    disabled: true

  - name: qwant
    disabled: true

categories_as_tabs:
  general:
  images:
  news:
  map:
  science:
  it:

enabled_plugins:
  - 'Hash plugin'
  - 'Search on category select'
  - 'Self Information'
  - 'Tracker URL remover'
  - 'Open Access DOI rewrite'
